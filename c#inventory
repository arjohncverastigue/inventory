using System;
using System.IO;

namespace Inventory_Management_System
{
    class Program
    {
        static void Main(string[] args)
        {
            string productFile = "products.txt";
            string salesFile = "sales.txt";

            if (!File.Exists(productFile))
            {
                File.WriteAllText(productFile,
                    "P001,Shampoo,120.50,30\n" +
                    "P002,Soap,35.00,50\n" +
                    "P003,Toothpaste,75.25,20\n");
                Console.WriteLine($"Created sample {productFile} file.\n");
            }
                Console.Write("Enter product id: ");
                string productId = Console.ReadLine().Trim();

                string[] products = File.ReadAllLines(productFile);
                string record = null;
                int recordIndex = -1;

                for (int i = 0; i < products.Length; i++)
                {
                    if (products[i].StartsWith(productId + ","))
                    {
                        record = products[i];
                        recordIndex = i;
                        break;
                    }
                }
                if(record != null)
                {
                    string[] parts = record.Split(',');
                    string Id = parts[0];
                    string ProductName = parts[1];
                    double Price =  Convert.ToDouble(parts[2]);
                    int Quantity = Convert.ToInt32(parts[3]);

                    Console.WriteLine("\nProduct Found!");
                    Console.WriteLine("Product name: " + ProductName);
                    Console.WriteLine("Price: " + Price);
                    Console.WriteLine("Quantity: " + Quantity);

                    Console.Write("Enter Quantity Sold: ");
                    int soldQ;
                    while (!int.TryParse(Console.ReadLine(), out soldQ) || soldQ < 0)
                    {
                        Console.Write("Invalid input! Please enter a positive number");
                    }
                    if(soldQ > Quantity)
                    {
                        Console.ForegroundColor = ConsoleColor.Red;
                        Console.WriteLine("\nNot enough stock available.");
                        Console.ResetColor();
                    }
                    else
                    {
                        double totalAmount = Price * soldQ;
                        int remainingStock = Quantity - soldQ;

                        Console.WriteLine("\nTotal amount: " + totalAmount.ToString("F2"));
                        Console.WriteLine("Remaining stock: " + remainingStock);

                        products[recordIndex] = $"{Id},{ProductName},{Price:F2},{remainingStock}";
                        File.WriteAllLines(productFile, products);

                        string saleLine = $"{Id},{ProductName},{soldQ},{totalAmount:F2},{DateTime.Now:yyyy-mm-dd}";
                        File.AppendAllText(salesFile, saleLine + Environment.NewLine);

                        Console.ForegroundColor = ConsoleColor.Green;
                        Console.WriteLine("\nTransaction saved to 'sales.txt'");
                        Console.ResetColor();
                    }
                }
                else
                {
                    Console.ForegroundColor = ConsoleColor.Red;
                    Console.WriteLine("\nProduct not found.");
                    Console.ResetColor();
                }
            
        }
    }
}

